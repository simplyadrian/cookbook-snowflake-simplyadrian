#!/bin/sh
#
# snowflake    Init script for snowflake
#
# chkconfig: 345 99 01
# processname: snowflake
# pidfile: var/run/snowflake.pid
# description: Starts and Stops and restarts snowflake process.
#

APP_NAME=<%= node['snowflake-nativex']['app']['nativex_snowflake_project_name'] %>

MAIN_JAR=<%= node['snowflake-nativex']['java']['main_jar'] %>
APP_HOME=<%= node['snowflake-nativex']['java']['snowflake_home'] %>
MAIN_CLASS=<%= node['snowflake-nativex']['java']['main-class'] %>
HEAP_OPTS=<%= node['snowflake-nativex']['java']['heap_opts'] %>
JMX_OPTS=<%= node['snowflake-nativex']['java']['jmx_opts'] %>
GC_OPTS=<%= node['snowflake-nativex']['java']['gc_opts'] %>
DEBUG_OPTS=<%= node['snowflake-nativex']['java']['debug_opts'] %>
JAVA_OPTS=<%= node['snowflake-nativex']['java']['java_opts'] %>
CLASSPATH_OPT="$APP_HOME/lib/*:$APP_HOME/$MAIN_JAR"

PID_PATH_NAME="/var/run/$APP_NAME.pid"

case $1 in
    start)
        echo "Starting $APP_NAME ..."
        if [ ! -f $PID_PATH_NAME ]; then
            nohup java ${JAVA_OPTS} -cp ${CLASSPATH_OPT} ${MAIN_CLASS} -f ${APP_HOME}/config/config.scala /tmp 2>> /dev/null >> /dev/null &
                        echo $! > $PID_PATH_NAME
            echo "$APP_NAME started ..."
        else
            echo "$APP_NAME is already running ..."
        fi
    ;;
    stop)
        if [ -f $PID_PATH_NAME ]; then
            PID=$(cat $PID_PATH_NAME);
            echo "$APP_NAME stoping ..."
            kill $PID;
            echo "$APP_NAME stopped ..."
            rm $PID_PATH_NAME
        else
            echo "$APP_NAME is not running ..."
        fi
    ;;
    restart)
        if [ -f $PID_PATH_NAME ]; then
            PID=$(cat $PID_PATH_NAME);
            echo "$APP_NAME stopping ...";
            kill $PID;
            echo "$APP_NAME stopped ...";
            rm $PID_PATH_NAME
            echo "$APP_NAME starting ..."
            nohup java ${JAVA_OPTS} -cp ${CLASSPATH_OPT} ${MAIN_CLASS} -f ${APP_HOME}/config/config.scala /tmp 2>> /dev/null >> /dev/null &
                        echo $! > $PID_PATH_NAME
            echo "$APP_NAME started ..."
        else
            echo "$APP_NAME is not running ..."
        fi
    ;;
esac 